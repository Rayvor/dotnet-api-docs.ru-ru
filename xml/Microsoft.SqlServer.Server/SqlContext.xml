<Type Name="SqlContext" FullName="Microsoft.SqlServer.Server.SqlContext">
  <Metadata><Meta Name="ms.openlocfilehash" Value="825d62a5e9710c1402283dbef5bd00b05faec9ce" /><Meta Name="ms.sourcegitcommit" Value="88014e1c5440e3df4f66ef04393854d15b1fd534" /><Meta Name="ms.translationtype" Value="MT" /><Meta Name="ms.contentlocale" Value="ru-RU" /><Meta Name="ms.lasthandoff" Value="09/05/2019" /><Meta Name="ms.locfileid" Value="70611936" /></Metadata><TypeSignature Language="C#" Value="public sealed class SqlContext" />
  <TypeSignature Language="ILAsm" Value=".class public auto ansi sealed beforefieldinit SqlContext extends System.Object" />
  <TypeSignature Language="DocId" Value="T:Microsoft.SqlServer.Server.SqlContext" />
  <TypeSignature Language="VB.NET" Value="Public NotInheritable Class SqlContext" />
  <TypeSignature Language="C++ CLI" Value="public ref class SqlContext sealed" />
  <TypeSignature Language="F#" Value="type SqlContext = class" />
  <AssemblyInfo>
    <AssemblyName>System.Data</AssemblyName>
    <AssemblyVersion>2.0.0.0</AssemblyVersion>
    <AssemblyVersion>4.0.0.0</AssemblyVersion>
  </AssemblyInfo>
  <Base>
    <BaseTypeName>System.Object</BaseTypeName>
  </Base>
  <Interfaces />
  <Docs>
    <summary><span data-ttu-id="8952e-101">Представляет абстракцию контекста вызывающего кода, обеспечивающую доступ к объектам <see cref="T:Microsoft.SqlServer.Server.SqlPipe" />, <see cref="T:Microsoft.SqlServer.Server.SqlTriggerContext" /> и <see cref="T:System.Security.Principal.WindowsIdentity" />.</span><span class="sxs-lookup"><span data-stu-id="8952e-101">Represents an abstraction of the caller's context, which provides access to the <see cref="T:Microsoft.SqlServer.Server.SqlPipe" />, <see cref="T:Microsoft.SqlServer.Server.SqlTriggerContext" />, and <see cref="T:System.Security.Principal.WindowsIdentity" /> objects.</span></span> <span data-ttu-id="8952e-102">Этот класс не наследуется.</span><span class="sxs-lookup"><span data-stu-id="8952e-102">This class cannot be inherited.</span></span></summary>
    <remarks>
      <format type="text/markdown"><![CDATA[  
  
## Remarks  
 <span data-ttu-id="8952e-103"><xref:Microsoft.SqlServer.Server.SqlContext> Объект можно использовать для получения контекста триггера (для кода, выполняемого в триггере) и объекта канала (если он доступен, например в хранимых процедурах).</span><span class="sxs-lookup"><span data-stu-id="8952e-103">The <xref:Microsoft.SqlServer.Server.SqlContext> object can be used to obtain the trigger context (for code executing in a trigger) and the pipe object (when available, such as in stored procedures).</span></span> <span data-ttu-id="8952e-104">Он также может использоваться для получения <xref:System.Security.Principal.WindowsIdentity> объекта, представляющего удостоверение Microsoft Windows вызывающего клиента, если клиент прошел проверку подлинности на сервере с помощью встроенной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="8952e-104">It can also be used to obtain a <xref:System.Security.Principal.WindowsIdentity> object that represents the Microsoft Windows identity of the calling client, if the client authenticated with the server using integrated authentication.</span></span>  
  
   
  
## Examples  
 <span data-ttu-id="8952e-105">В следующем примере создается новый <xref:Microsoft.SqlServer.Server.SqlDataRecord> объект и его свойство. <xref:Microsoft.SqlServer.Server.SqlMetaData></span><span class="sxs-lookup"><span data-stu-id="8952e-105">The following example creates a new <xref:Microsoft.SqlServer.Server.SqlDataRecord> and its <xref:Microsoft.SqlServer.Server.SqlMetaData>.</span></span> <span data-ttu-id="8952e-106">Затем пример отмечает начало результирующего набора с помощью <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsStart%2A> метода, отправляет записи с примерами данных обратно клиенту <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsRow%2A> с помощью метода и помечает конец результирующего набора <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsEnd%2A> методом.</span><span class="sxs-lookup"><span data-stu-id="8952e-106">The example then marks the beginning of a result set using the <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsStart%2A> method, sends records with example data back to the client using the <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsRow%2A> method, and marks the end of the result set with the <xref:Microsoft.SqlServer.Server.SqlPipe.SendResultsEnd%2A> method.</span></span>  
  
 [!code-csharp[DataWorks SqlPipe.SendResultsRow#1](~/samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlPipe.SendResultsRow/CS/source.cs#1)]
 [!code-vb[DataWorks SqlPipe.SendResultsRow#1](~/samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlPipe.SendResultsRow/VB/source.vb#1)]  
  
 ]]></format>
    </remarks>
  </Docs>
  <Members>
    <Member MemberName="IsAvailable">
      <MemberSignature Language="C#" Value="public static bool IsAvailable { get; }" />
      <MemberSignature Language="ILAsm" Value=".property bool IsAvailable" />
      <MemberSignature Language="DocId" Value="P:Microsoft.SqlServer.Server.SqlContext.IsAvailable" />
      <MemberSignature Language="VB.NET" Value="Public Shared ReadOnly Property IsAvailable As Boolean" />
      <MemberSignature Language="C++ CLI" Value="public:&#xA; static property bool IsAvailable { bool get(); };" />
      <MemberSignature Language="F#" Value="member this.IsAvailable : bool" Usage="Microsoft.SqlServer.Server.SqlContext.IsAvailable" />
      <MemberType>Property</MemberType>
      <AssemblyInfo>
        <AssemblyName>System.Data</AssemblyName>
        <AssemblyVersion>2.0.0.0</AssemblyVersion>
        <AssemblyVersion>4.0.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>System.Boolean</ReturnType>
      </ReturnValue>
      <Docs>
        <summary><span data-ttu-id="8952e-107">Показывает, выполняется ли вызывающий код в SQL Server и доступно ли контекстное соединение.</span><span class="sxs-lookup"><span data-stu-id="8952e-107">Specifies whether the calling code is running within SQL Server, and if the context connection can be accessed.</span></span></summary>
        <value><span data-ttu-id="8952e-108"><see langword="True" />, если контекстное соединение доступно, равно как и остальные члены класса <see cref="T:Microsoft.SqlServer.Server.SqlContext" />.</span><span class="sxs-lookup"><span data-stu-id="8952e-108"><see langword="True" /> if the context connection is available and the other <see cref="T:Microsoft.SqlServer.Server.SqlContext" /> members can be accessed.</span></span></value>
        <remarks>
          <format type="text/markdown"><![CDATA[  
  
## Remarks  
 <span data-ttu-id="8952e-109">Если это свойство возвращает значение false, все остальные <xref:Microsoft.SqlServer.Server.SqlContext> члены <xref:System.InvalidOperationException> создают исключение при использовании.</span><span class="sxs-lookup"><span data-stu-id="8952e-109">If this property returns false, all the other <xref:Microsoft.SqlServer.Server.SqlContext> members throw an <xref:System.InvalidOperationException> if used.</span></span>  
  
 <span data-ttu-id="8952e-110">Если это свойство возвращает значение false, то любая попытка открыть объект соединения, в строке подключения которого задано контекстное соединение = true, завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="8952e-110">If this property returns false, any attempt to open a connection object that has "context connection=true" in the connection string fails.</span></span>  
  
 <span data-ttu-id="8952e-111">Это свойство доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="8952e-111">This property is read-only.</span></span>  
  
 <span data-ttu-id="8952e-112">При использовании ADO.NET для доступа к данным, если фрагмент кода может выполняться как внутри SQL Server (с помощью интеграции со средой CLR), так и снаружи SQL Server, это свойство можно использовать для проверки доступности контекстного соединения.</span><span class="sxs-lookup"><span data-stu-id="8952e-112">When using ADO.NET for data-access, if a piece of code may run both inside SQL Server (using common language runtime integration) and outside SQL Server, this property can be used to check whether the context connection is available.</span></span>  
  
 ]]></format>
        </remarks>
      </Docs>
    </Member>
    <Member MemberName="Pipe">
      <MemberSignature Language="C#" Value="public static Microsoft.SqlServer.Server.SqlPipe Pipe { get; }" />
      <MemberSignature Language="ILAsm" Value=".property class Microsoft.SqlServer.Server.SqlPipe Pipe" />
      <MemberSignature Language="DocId" Value="P:Microsoft.SqlServer.Server.SqlContext.Pipe" />
      <MemberSignature Language="VB.NET" Value="Public Shared ReadOnly Property Pipe As SqlPipe" />
      <MemberSignature Language="C++ CLI" Value="public:&#xA; static property Microsoft::SqlServer::Server::SqlPipe ^ Pipe { Microsoft::SqlServer::Server::SqlPipe ^ get(); };" />
      <MemberSignature Language="F#" Value="member this.Pipe : Microsoft.SqlServer.Server.SqlPipe" Usage="Microsoft.SqlServer.Server.SqlContext.Pipe" />
      <MemberType>Property</MemberType>
      <AssemblyInfo>
        <AssemblyName>System.Data</AssemblyName>
        <AssemblyVersion>2.0.0.0</AssemblyVersion>
        <AssemblyVersion>4.0.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.SqlServer.Server.SqlPipe</ReturnType>
      </ReturnValue>
      <Docs>
        <summary><span data-ttu-id="8952e-113">Получает объект канала, позволяющий отправлять из вызывающего кода клиенту результирующие наборы, сообщения и результаты выполнения команд.</span><span class="sxs-lookup"><span data-stu-id="8952e-113">Gets the pipe object that allows the caller to send result sets, messages, and the results of executing commands back to the client.</span></span></summary>
        <value><span data-ttu-id="8952e-114">Экземпляр <see cref="T:Microsoft.SqlServer.Server.SqlPipe" />, если канал доступен, или <see langword="null" /> при вызове из контекста, в котором канал недоступен (например, в пользовательской функции).</span><span class="sxs-lookup"><span data-stu-id="8952e-114">An instance of <see cref="T:Microsoft.SqlServer.Server.SqlPipe" /> if a pipe is available, or <see langword="null" /> if called in a context where pipe is not available (for example, in a user-defined function).</span></span></value>
        <remarks>
          <format type="text/markdown"><![CDATA[  
  
## Remarks  
 <span data-ttu-id="8952e-115">Если вызывается извне SQL Server, <xref:System.NotSupportedException> создается исключение.</span><span class="sxs-lookup"><span data-stu-id="8952e-115">If invoked from outside SQL Server, a <xref:System.NotSupportedException> is thrown.</span></span>  
  
 <span data-ttu-id="8952e-116">Это свойство доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="8952e-116">This property is read-only.</span></span>  
  
 ]]></format>
        </remarks>
      </Docs>
    </Member>
    <Member MemberName="TriggerContext">
      <MemberSignature Language="C#" Value="public static Microsoft.SqlServer.Server.SqlTriggerContext TriggerContext { get; }" />
      <MemberSignature Language="ILAsm" Value=".property class Microsoft.SqlServer.Server.SqlTriggerContext TriggerContext" />
      <MemberSignature Language="DocId" Value="P:Microsoft.SqlServer.Server.SqlContext.TriggerContext" />
      <MemberSignature Language="VB.NET" Value="Public Shared ReadOnly Property TriggerContext As SqlTriggerContext" />
      <MemberSignature Language="C++ CLI" Value="public:&#xA; static property Microsoft::SqlServer::Server::SqlTriggerContext ^ TriggerContext { Microsoft::SqlServer::Server::SqlTriggerContext ^ get(); };" />
      <MemberSignature Language="F#" Value="member this.TriggerContext : Microsoft.SqlServer.Server.SqlTriggerContext" Usage="Microsoft.SqlServer.Server.SqlContext.TriggerContext" />
      <MemberType>Property</MemberType>
      <AssemblyInfo>
        <AssemblyName>System.Data</AssemblyName>
        <AssemblyVersion>2.0.0.0</AssemblyVersion>
        <AssemblyVersion>4.0.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.SqlServer.Server.SqlTriggerContext</ReturnType>
      </ReturnValue>
      <Docs>
        <summary><span data-ttu-id="8952e-117">Получает контекст триггера, используемый для передачи в вызывающий код сведений о причинах срабатывания триггера и таблицы обновленных столбцов.</span><span class="sxs-lookup"><span data-stu-id="8952e-117">Gets the trigger context used to provide the caller with information about what caused the trigger to fire, and a map of the columns that were updated.</span></span></summary>
        <value><span data-ttu-id="8952e-118">Экземпляр <see cref="T:Microsoft.SqlServer.Server.SqlTriggerContext" />, если контекст триггера доступен, или <see langword="null" /> при вызове извне области действия триггера.</span><span class="sxs-lookup"><span data-stu-id="8952e-118">An instance of <see cref="T:Microsoft.SqlServer.Server.SqlTriggerContext" /> if a trigger context is available, or <see langword="null" /> if called outside of a trigger invocation.</span></span></value>
        <remarks>
          <format type="text/markdown"><![CDATA[  
  
## Remarks  
 <span data-ttu-id="8952e-119"><xref:Microsoft.SqlServer.Server.SqlTriggerContext> Объект может быть получен только из триггера среды CLR.</span><span class="sxs-lookup"><span data-stu-id="8952e-119">The <xref:Microsoft.SqlServer.Server.SqlTriggerContext> object can only be retrieved from within a common language runtime trigger.</span></span>  
  
 <span data-ttu-id="8952e-120">Если доступ к <xref:System.NotSupportedException> свойству осуществляется извне SQL Server <xref:Microsoft.SqlServer.Server.SqlContext.TriggerContext%2A>  , создается исключение.</span><span class="sxs-lookup"><span data-stu-id="8952e-120">If the <xref:Microsoft.SqlServer.Server.SqlContext.TriggerContext%2A> property is accessed from outside of SQL Server, a <xref:System.NotSupportedException> is thrown.</span></span>  
  
 <span data-ttu-id="8952e-121">Это свойство доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="8952e-121">This property is read-only.</span></span>  
  
 ]]></format>
        </remarks>
      </Docs>
    </Member>
    <Member MemberName="WindowsIdentity">
      <MemberSignature Language="C#" Value="public static System.Security.Principal.WindowsIdentity WindowsIdentity { get; }" />
      <MemberSignature Language="ILAsm" Value=".property class System.Security.Principal.WindowsIdentity WindowsIdentity" />
      <MemberSignature Language="DocId" Value="P:Microsoft.SqlServer.Server.SqlContext.WindowsIdentity" />
      <MemberSignature Language="VB.NET" Value="Public Shared ReadOnly Property WindowsIdentity As WindowsIdentity" />
      <MemberSignature Language="C++ CLI" Value="public:&#xA; static property System::Security::Principal::WindowsIdentity ^ WindowsIdentity { System::Security::Principal::WindowsIdentity ^ get(); };" />
      <MemberSignature Language="F#" Value="member this.WindowsIdentity : System.Security.Principal.WindowsIdentity" Usage="Microsoft.SqlServer.Server.SqlContext.WindowsIdentity" />
      <MemberType>Property</MemberType>
      <AssemblyInfo>
        <AssemblyName>System.Data</AssemblyName>
        <AssemblyVersion>2.0.0.0</AssemblyVersion>
        <AssemblyVersion>4.0.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>System.Security.Principal.WindowsIdentity</ReturnType>
      </ReturnValue>
      <Docs>
        <summary><span data-ttu-id="8952e-122">Удостоверение Microsoft Windows для вызывающего кода.</span><span class="sxs-lookup"><span data-stu-id="8952e-122">The Microsoft Windows identity of the caller.</span></span></summary>
        <value><span data-ttu-id="8952e-123">Экземпляр <see cref="T:System.Security.Principal.WindowsIdentity" />, представляющий удостоверение Windows для вызывающего кода, или <see langword="null" />, если клиент прошел проверку подлинности с помощью средств проверки подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8952e-123">A <see cref="T:System.Security.Principal.WindowsIdentity" /> instance representing the Windows identity of the caller, or <see langword="null" /> if the client was authenticated using SQL Server Authentication.</span></span></value>
        <remarks>
          <format type="text/markdown"><![CDATA[  
  
## Remarks  
 <span data-ttu-id="8952e-124">Код среды CLR в SQL Server всегда вызывается в контексте учетной записи процесса.</span><span class="sxs-lookup"><span data-stu-id="8952e-124">Common language runtime (CLR) code inside SQL Server is always invoked in the context of the process account.</span></span> <span data-ttu-id="8952e-125">Если необходимо, чтобы код выполнил действие с помощью вызова удостоверения пользователя вместо SQL Server удостоверения процесса, то маркер олицетворения должен быть получен через это свойство.</span><span class="sxs-lookup"><span data-stu-id="8952e-125">If it is necessary for the code to perform an action using calling user's identity instead of the SQL Server process identity, then an impersonation token should be obtained through this property.</span></span> <span data-ttu-id="8952e-126">Получив объект <xref:System.Security.Principal.WindowsIdentity>, вызывающие могут олицетворять учетную запись клиента и выполнять действия от их имени.</span><span class="sxs-lookup"><span data-stu-id="8952e-126">After obtaining the <xref:System.Security.Principal.WindowsIdentity> object, callers can impersonate the client account and perform actions on their behalf.</span></span>  
  
 <span data-ttu-id="8952e-127">Если вызывается извне SQL Server, <xref:System.NotSupportedException> создается исключение.</span><span class="sxs-lookup"><span data-stu-id="8952e-127">If invoked from outside SQL Server, a <xref:System.NotSupportedException> is thrown.</span></span>  
  
 <span data-ttu-id="8952e-128">Доступ к этому свойству могут получить только сборки, имеющие разрешения `EXTERNAL_ACCESS` или `UNSAFE`.</span><span class="sxs-lookup"><span data-stu-id="8952e-128">Only assemblies marked with `EXTERNAL_ACCESS` or `UNSAFE` permissions can access this property.</span></span>  
  
 <span data-ttu-id="8952e-129">Это свойство доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="8952e-129">This property is read-only.</span></span>  
  
   
  
## Examples  
 <span data-ttu-id="8952e-130">В следующем примере показано, как получить удостоверение Windows вызывающего клиента и выполнить олицетворение клиента.</span><span class="sxs-lookup"><span data-stu-id="8952e-130">The following example shows how to get the Windows identity of the calling client and impersonate the client.</span></span>
  
 [!code-csharp[DataWorks SqlContext.WindowsIdentity Sample#1](~/samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlContext.WindowsIdentity Sample/CS/source.cs#1)]
 [!code-vb[DataWorks SqlContext.WindowsIdentity Sample#1](~/samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlContext.WindowsIdentity Sample/VB/source.vb#1)]  
  
 ]]></format>
        </remarks>
      </Docs>
    </Member>
  </Members>
</Type>
